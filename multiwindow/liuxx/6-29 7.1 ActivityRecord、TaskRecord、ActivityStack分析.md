#  ActivityRecord、TaskRecord、ActivityStack分析

  - 每一个ActivityRecord都会有一个Activity与之对应，一个Activity可能会有多个ActivityRecord，因为Activity可以被多次实例化，取决于其launchmode。一系列相关的ActivityRecord组成了一个TaskRecord，TaskRecord是存在于ActivityStack中，ActivityStackSupervisor是用来管理这些ActivityStack的。
![](https://github.com/openthos/community-analysis/blob/master/pic/7.1.png)</br>
可以看到一个ActivityStack可以包含很多个TaskRecord，一个TaskRecord又可以包含很多个ActivityRecord。

## ActivityRecord

  - 1.ActivityRecord包含了一个Activity的所有信息，比较重要的对象主要有
  
  frameworks/base/services/core/java/com/android/server/am/ActivityRecord.java  
  
    //ams的引用  
    final ActivityManagerService service; // owner  
    //token用来和wms交互  
    final IApplicationToken.Stub appToken; // window manager token  
    final ActivityInfo info; // all about me  
    final ApplicationInfo appInfo; // information about activity's app  
    ...  
  
    //Activity资源信息  
    CharSequence nonLocalizedLabel;  // the label information from the package mgr.  
    int labelRes;           // the label information from the package mgr.  
    int icon;               // resource identifier of activity's icon.  
    int logo;               // resource identifier of activity's logo.  
    int theme;              // resource identifier of activity's theme.  
    int realTheme;          // actual theme resource we will use, never 0.  
    int windowFlags;        // custom window flags for preview window.  
      
    //ActivityRecord所在的TaskRecord  
    TaskRecord task;        // the task this is in.  
    ...  
    //ActivityRecord所在进程  
    ProcessRecord app;      // if non-null, hosting application  
    ActivityState state;    // current state we are in  
    ...  
    
    其中task对象标识了所在的其所在的TaskRecord，这样ActivityRecord和TaskRecord就联系起来了。
